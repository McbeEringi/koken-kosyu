# ESP講習 @Koken UEC
## 目次
- 今回の基板について
- ESP?
	- 概要
	- リファレンス
	- 機能
	- 種類と比較
	- 注意事項

## 今回の基板について
- 部品
	- ESP32-C3-WROOM-02 モジュール
	- USBコネクタ
	- LM1117 3.3vレギュレータ
	- OSTW3535 NeoPixel互換
- 特徴
	- 部品点数が非常に少なく小型
		- 表面実装部品で統一
		- UEW(エナメル線)で配線
		- 極限まで部品を省略
			- USB-シリアル変換が載っていない
				- 多くの場合USBとマイコンでシリアル通信をするには専用の変換チップが必要
				- ESP32C3はUSB(USB CDC)を搭載しているので内部でエミュレートできる
			- NeoPixelの信号電圧レベル変換が載っていない
				- 本来はfetを使ったレベル変換回路が必要
				- 5v電源で動いているところに3.3vの信号を入れている
				- 動作保証外だが動く

## ESP?
### 概要
- espressif社が開発しているIoTなマイコン
	- 5mm角くらいのチップ
	- モジュール?
		- チップの周りにフラッシュメモリとかコンデンサとか水晶と一緒に小さな基板に載せたもの
		- 電源繋げれば動く状態の基板
	- 開発ボード?
		- モジュールをコネクタやシリアル変換チップと一緒に基板に載せたもの
		- PCとすぐ繋げて開発できる基板
		- 普段我々が見ているのはこの姿

### リファレンス
- [ESP-IDFの公式ドキュメントのAPI Guides](https://docs.espressif.com/projects/esp-idf/en/latest/esp32c3/api-guides/)
	- ESP-IDF=公式の開発環境
	- チップの機能が分かる
	- 開発環境は違えど使うチップは同じなのでかなり参考になる
- [Arduino-ESP32の公式ドキュメント](https://docs.espressif.com/projects/arduino-esp32/en/latest/)
	- Arduino環境でのESPの叩き方が分かる

### 機能
- WiFi
- Bluetooth
- 性能が良い

### 種類と比較
- ESP8266
- ESP32
	- ESP32(無印)
	- ESP32-C3
	- ESP32-S3
	
|8266|無印|C3|S3
---|---|---|---|---
モジュール名称|ESP-WROOM-02|ESP32-WROOM-32E|ESP32-C3-WROOM-02|ESP32-S3-WROOM-1
サイズmm|18x20x3|18x25.5x3.1|18×20×3.2|18x25.5x3.1
コア数|1|2|1|2
CPU|L106|Xtensa LX6|RISC-V|Xtensa LX7
周波数MHz|160|160|160|160
ビット数|32|32|32|32
フラッシュ容量|2,4|4,8,16|4|4,8,16
PWMチャネル数|8|8|6|8
USB CDC|x|x|o|o
USB OTG|x|x|x|o
WiFi|o|o|o|o
Bluetooth Classic|x|o|x|x
Bluetooth Low Energy|x|o|o|o
Ethernet|x|o|x|x
秋月プライス¥|360|480|310|530

### 注意事項
- 電源もIOも3.3V
	- Arduino UNOは5V
	- 互換性のない周辺機器の例
		- 4.8V以上ないと動かない
		- 3.6V以上あると壊れる
	- 逆にESPのIOに間違えて5Vとか加えるとESPが壊れる
	- データシートはよく読もう
	- 相対的に電圧の高い部品の扱いは慎重に
- Arduinoに比べると電力食い
	- WiFi機能を使うと顕著
	- 割とアチアチになる
	- 最低限常時300mAは流せた方がいい



# おまけ
## NeoPixel?
参考になりそう: https://ht-deko.com/arduino/neopixel.html
### 概要
- フルカラーLED
	- RGB3色のLEDが一つずつ入っている
- 信号線一本で制御できる
	- LEDと一緒にICが入っている
	- 複数個のNeoPixelも1本の信号線で扱える
		- 数珠繋ぎにしたNeoPixelにシリアル信号をまとめて流せる
- 5mm角4端子のチップ形状であることが多い

### 互換品
- WorldSemi社が最初(多分)に売り出した
	- WS2812B
		- 本家
	- WS2813B 
		- 数珠つなぎの途切れに強くなった改良版
- 他社も互換品を売り出している
	- OptoSupply
		- LED大手
	- DONGGUAN OPSCO OPTOELECTRONICS CO., LTD
		- 秋月で売ってる
- 基本的にどれ選んでも同じ
- 選定する際の注意事項
	- 動作電圧が12Vのものがある
	- 稀にシリアル信号のフォーマットが異なるものがある
		- 主流はGRB
	- 稀に信号線が特殊なものがある

### 注意事項
- 動作電圧は基本5V
	- 動かない例
		- LEDの電源に3.3Vを供給しても動かない可能性がある
		- 5Vの電源に繋げて動かすと3.3Vの信号は無視される可能性がある
			- 解決策:「レベルシフト fet」で検索
	- データシートを読もう
	- でも意外と動いちゃったりする
		- 動けば正義なので問題なし
		- 動かなくても文句言えない
- チップLEDはとても熱に弱い
	- LEDがそもそも熱に弱い
	- チップ部品は物理的に小さいのですぐ熱くなる
	- はんだ付け
		- 加熱時間は最短を心掛ける
			- 予備はんだの活用
		- 放熱の時間を確保
			- 指で触ってやるだけでも冷める
		- 近くに放熱性能の高い部品をなるべく置かない
			- その部品をはんだ付けした熱が配線を伝ってLEDを破壊しに来る
			- 熱的になるべく切り離す